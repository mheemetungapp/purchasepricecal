<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Recycle Pricing</title>
    
    <link rel="icon" type="image/jpeg" href="icon.jpg">
    <link rel="apple-touch-icon" href="icon.jpg">

    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        /* =========================================
           1. CORE VARIABLES & RESET
           ========================================= */
        :root {
            --primary-color: #1e3a8a;
            --money-color: #16a34a;
            --bg-color: #f3f4f6;
            --text-color: #1f2937;
            --border-color: #e5e7eb;
        }
        
        body { 
            font-family: 'Sarabun', sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text-color); 
            margin: 0; 
            padding: 10px; 
        }

        /* =========================================
           2. LAYOUT & CONTAINER
           ========================================= */
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white; 
            padding: 15px; 
            border-radius: 12px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); 
            position: relative; 
        }

        h2 { 
            text-align: center; 
            margin: 5px 0 15px; 
            font-weight: 800; 
            font-size: 1.4rem; 
        }

        .footer-credit { 
            text-align: center; 
            margin-top: 30px; 
            margin-bottom: 10px; 
            color: #9ca3af; 
            font-style: italic; 
            font-size: 0.9em; 
        }

        /* =========================================
           3. UI COMPONENTS
           ========================================= */
        /* Settings Gear (Minimal Style) */
        .settings-gear { 
            position: absolute; 
            top: 12px;    
            right: 12px;  
            font-size: 20px; 
            color: #9ca3af; 
            cursor: pointer; 
            z-index: 10; 
            transition: transform 0.3s, color 0.3s; 
        }
        .settings-gear:hover { color: var(--primary-color); transform: scale(1.1); }
        .spinning { animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Toggle Switch Area */
        .mode-switch-container { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            background: #e0f2fe; 
            padding: 15px; 
            border-radius: 10px; 
            margin-bottom: 20px; 
            border: 1px solid #bae6fd; 
        }
        .switch { position: relative; display: inline-block; width: 50px; height: 28px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { 
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; 
            background-color: #ccc; transition: .4s; border-radius: 34px; 
        }
        .slider:before { 
            position: absolute; content: ""; height: 20px; width: 20px; 
            left: 4px; bottom: 4px; background-color: white; 
            transition: .4s; border-radius: 50%; 
        }
        input:checked + .slider { background-color: #2563eb; }
        input:checked + .slider:before { transform: translateX(22px); }

        /* Settings Inputs Panel */
        .settings-panel { 
            background: #f9fafb; 
            padding: 15px; 
            border-radius: 10px; 
            margin-bottom: 20px; 
            border: 1px solid var(--border-color); 
            display: none; 
        }
        .settings-panel.active { display: block; animation: fadeIn 0.3s; }
        .input-row { display: flex; gap: 10px; }
        .input-col { flex: 1; }
        .input-col input { 
            width: 100%; padding: 8px; border: 1px solid #ccc; 
            border-radius: 6px; text-align: center; font-weight: bold; box-sizing: border-box; 
        }

        /* =========================================
           4. PRODUCT LIST & CARDS
           ========================================= */
        .category-group { margin-bottom: 12px; border: 1px solid var(--border-color); border-radius: 8px; overflow: hidden; }
        .category-header { 
            background-color: var(--primary-color); color: white; padding: 12px 15px; 
            cursor: pointer; display: flex; justify-content: space-between; font-weight: bold; font-size: 1.1em; 
        }
        .category-content { display: block; padding: 10px; background: #f8fafc; }
        .category-content.hidden { display: none; }
        
        .cat-plastic .category-header { background-color: #f59e0b; color: black; } 
        .cat-paper .category-header { background-color: #fca5a5; color: black; } 
        .cat-metal .category-header { background-color: #9ca3af; color: black; } 
        .cat-glass .category-header { background-color: #86efac; color: black; } 
        .cat-other .category-header { background-color: #c4b5fd; color: black; } 

        .card { background: white; border: 1px solid #d1d5db; border-radius: 8px; padding: 10px; margin-bottom: 8px; }
        .card-row { display: flex; gap: 8px; align-items: center; margin-top: 5px; }
        
        .input-group { flex: 1; display: flex; flex-direction: column; }
        .input-group label { font-size: 0.7rem; color: #6b7280; text-align: center; margin-bottom: 2px;}
        .input-group input { width: 100%; padding: 6px; text-align: center; border: 1px solid #d1d5db; border-radius: 4px; box-sizing: border-box;}
        
        .result-box { 
            flex: 1.3; background: #dcfce7; border: 1px solid #86efac; border-radius: 6px; 
            text-align: center; padding: 4px; height: 50px; 
            display: flex; flex-direction: column; justify-content: center; 
        }
        .result-price { font-size: 1.3rem; font-weight: 800; color: var(--money-color); line-height: 1; }
        .result-label { font-size: 0.7rem; color: var(--money-color); }
        
        .btn-del { border: none; background: none; color: #ef4444; font-size: 1.5rem; cursor: pointer; padding: 0 5px; }
        .btn-move-group { display: flex; flex-direction: column; gap: 2px; }
        .btn-move { 
            border: 1px solid #d1d5db; background: #f3f4f6; 
            cursor: pointer; font-size: 0.6rem; padding: 2px 6px; border-radius: 4px; 
            line-height: 1; color: #555;
        }
        .btn-move:hover { background: #e5e7eb; color: #000; border-color: #9ca3af; }

        .btn-add { 
            width: 100%; padding: 10px; background: white; border: 2px dashed #d1d5db; 
            color: #6b7280; border-radius: 6px; margin-top: 5px; font-weight: 600; cursor: pointer; 
        }

        /* =========================================
           5. MODAL (HELP & SETTINGS)
           ========================================= */
        .modal { 
            display: none; position: fixed; z-index: 100; left: 0; top: 0; 
            width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); backdrop-filter: blur(2px); 
        }
        .modal-content { 
            background-color: #fefefe; margin: 5% auto; padding: 25px; 
            border: 1px solid #888; width: 90%; max-width: 600px; 
            border-radius: 12px; max-height: 90vh; overflow-y: auto; position: relative;
        }
        .close-btn { float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        
        .modal h3 { color: #1e3a8a; border-bottom: 1px solid #eee; padding-bottom: 8px; margin-top: 20px; }
        .guide-step { margin-bottom: 10px; font-size: 0.95em; display: flex; align-items: flex-start; gap: 10px; }
        .guide-icon { min-width: 25px; font-size: 1.2em; text-align: center; }
        
        .guide-table { width: 100%; border-collapse: collapse; font-size: 0.85em; margin-top: 10px; }
        .guide-table th, .guide-table td { border: 1px solid #e5e7eb; padding: 8px; text-align: left; }
        .guide-table th { background-color: #eff6ff; text-align: center; }
        
        .btn-reset {
            background-color: #ef4444; color: white; border: none; padding: 8px 15px;
            border-radius: 6px; cursor: pointer; font-size: 0.9em; margin-top: 20px; width: 100%;
        }
        .btn-reset:hover { background-color: #dc2626; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div class="container">
    <div class="settings-gear" id="gearIcon" onclick="UI.toggleModal(true)">‚öôÔ∏è</div>
    <h2>üí∞ ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠ üí∞</h2>

    <div class="mode-switch-container">
        <div>
            <div style="font-weight: bold; color: #0369a1; font-size: 1.1em;" id="modeLabel">üöö ‡πÑ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á (‡∏Ñ‡∏¥‡∏î‡∏Ñ‡πà‡∏≤‡∏£‡∏ñ)</div>
            <div style="font-size: 0.8em; color: #6b7280;">‡∏´‡∏±‡∏Å‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤</div>
        </div>
        <label class="switch">
            <input type="checkbox" id="transportToggle" checked onchange="App.toggleMode()">
            <span class="slider"></span>
        </label>
    </div>

    <div class="settings-panel active" id="transportSettings">
        <div class="input-row">
            <div class="input-col">
                <label style="font-size: 0.8em;">‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°/‡∏Å‡∏°.</label>
                <input type="number" id="costPerKm" value="7" onchange="App.handleSettingChange()" onfocus="this.select()">
            </div>
            <div class="input-col">
                <label style="font-size: 0.8em;">‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á (‡∏Å‡∏°.)</label>
                <input type="number" id="distance" value="20" onchange="App.handleSettingChange()" onfocus="this.select()">
            </div>
            <div class="input-col">
                <label style="font-size: 0.8em;">‡∏ô‡∏ô. ‡∏£‡∏ß‡∏° (‡∏Å‡∏Å.)</label>
                <input type="number" id="totalWeight" value="500" onchange="App.handleSettingChange()" onfocus="this.select()">
            </div>
        </div>
        <div style="text-align: center; margin-top: 8px; color: #15803d; font-weight: 600; font-size: 0.9em;">
            ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Ç‡∏ô‡∏™‡πà‡∏á = <span id="transportCostDisplay">0.00</span> ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.
        </div>
    </div>

    <div id="app-container"></div>
    
    <div class="footer-credit">Developed By Mheemetung</div>
</div>

<div id="settingsModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="UI.toggleModal(false)">&times;</span>
        <h2 style="margin-top: 0;">üìñ ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h2>
        
        <div>
            <h3>üõ†Ô∏è ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô</h3>
            <div class="guide-step">
                <div class="guide-icon">üîÑ</div>
                <div><b>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î:</b> ‡∏Å‡∏î‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡πà‡∏≤ "‡πÑ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á" (‡∏´‡∏±‡∏Å‡∏Ñ‡πà‡∏≤‡∏£‡∏ñ) ‡∏´‡∏£‡∏∑‡∏≠ "‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏°‡∏≤‡∏™‡πà‡∏á‡πÄ‡∏≠‡∏á" (‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ï‡πá‡∏°)</div>
            </div>
            <div class="guide-step">
                <div class="guide-icon">üìù</div>
                <div><b>‡∏Å‡∏£‡∏≠‡∏Å‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô:</b> ‡πÉ‡∏™‡πà‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏à‡∏≥‡∏Ñ‡πà‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏°‡∏≠</div>
            </div>
            <div class="guide-step">
                <div class="guide-icon">üíæ</div>
                <div><b>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥:</b> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡∏°‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢</div>
            </div>
        </div>

        <div>
            <h3>üßÆ ‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</h3>
            <div style="background:#f3f4f6; padding:10px; border-radius:6px; text-align:center; color:#dc2626; font-weight:bold; font-family:monospace; font-size:0.9em;">
                ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠ = ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏•‡∏≤‡∏î - (‡∏Å‡∏≥‡πÑ‡∏£%) - (‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Ñ‡πà‡∏≤‡∏£‡∏ñ)
            </div>
        </div>

        <div style="margin-bottom: 20px;">
            <h3>üìä ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ % ‡∏Å‡∏≥‡πÑ‡∏£</h3>
            <table class="guide-table">
                <thead><tr><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th style="text-align:center">% ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</th></tr></thead>
                <tbody>
                    <tr><td>‡∏ó‡∏≠‡∏á‡πÅ‡∏î‡∏á/‡∏ó‡∏≠‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á</td><td style="text-align:center">5-12%</td></tr>
                    <tr><td>‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°</td><td style="text-align:center">15-20%</td></tr>
                    <tr><td>‡πÄ‡∏´‡∏•‡πá‡∏Å</td><td style="text-align:center">15-25%</td></tr>
                    <tr><td>‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å</td><td style="text-align:center">20-30%</td></tr>
                    <tr><td>‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©</td><td style="text-align:center">25-35%</td></tr>
                    <tr><td>‡πÅ‡∏Å‡πâ‡∏ß/‡∏Ç‡∏ß‡∏î‡πÄ‡∏ö‡∏µ‡∏¢‡∏£‡πå</td><td style="text-align:center">40-50%</td></tr>
                </tbody>
            </table>
        </div>

        <hr style="border: 0; border-top: 1px solid #eee;">
        <button class="btn-reset" onclick="App.resetToFactory()">‚ö†Ô∏è ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)</button>
    </div>
</div>

<script>
    /**
     * ==========================================
     * ZONE 1: CONFIGURATION (‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô)
     * ==========================================
     */
    const Config = {
        categories: {
            "‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å": {
                items: [
                    { name: "‡∏Ç‡∏ß‡∏î PET ‡πÉ‡∏™", price: 7.0, margin: 30 },
                    { name: "‡∏Ç‡∏ß‡∏î PET ‡πÉ‡∏™ ‡πÅ‡∏Å‡∏∞", price: 9.0, margin: 30 },
                    { name: "‡∏Ç‡∏ß‡∏î PET ‡∏™‡∏µ", price: 2.0, margin: 30 },
                    { name: "‡∏Ç‡∏ß‡∏î PET ‡∏™‡∏Å‡∏£‡∏µ‡∏ô", price: 3.0, margin: 30 },
                    { name: "‡∏Ç‡∏ß‡∏î PET ‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏û‡∏∑‡∏ä", price: 3.0, margin: 30 },
                    { name: "‡∏Ç‡∏ß‡∏î‡∏ô‡∏° HDPE", price: 15.0, margin: 30 },
                    { name: "‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å‡∏™‡∏µ", price: 7.5, margin: 30 },
                    { name: "‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å‡∏î‡∏≥", price: 3.0, margin: 30 },
                    { name: "‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å‡∏Å‡∏£‡∏≠‡∏ö", price: 3.0, margin: 30 },
                    { name: "‡πÅ‡∏ú‡πà‡∏ô CD", price: 3.0, margin: 30 },
                    { name: "PVC ‡∏™‡∏µ‡∏ü‡πâ‡∏≤", price: 5.0, margin: 30 },
                    { name: "‡∏ñ‡∏∏‡∏á‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å", price: 1.0, margin: 30 }
                ],
                styleClass: "cat-plastic",
                defaultMargin: 30
            },
            "‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©": {
                items: [
                    { name: "‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏•‡∏±‡∏á", price: 3.2, margin: 35 },
                    { name: "‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏Ç‡∏≤‡∏ß‡∏î‡∏≥", price: 5.5, margin: 35 },
                    { name: "‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏¢‡πà‡∏≠‡∏¢", price: 2.5, margin: 35 },
                    { name: "‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ô‡∏°", price: 2.0, margin: 40 }
                ],
                styleClass: "cat-paper",
                defaultMargin: 30
            },
            "‡πÇ‡∏•‡∏´‡∏∞": {
                items: [
                    { name: "‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏ö‡∏≤‡∏á", price: 7, margin: 25 },
                    { name: "‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏´‡∏ô‡∏≤", price: 8.5, margin: 25 },
                    { name: "‡∏Å‡∏£‡∏∞‡∏õ‡πã‡∏≠‡∏á‡πÄ‡∏´‡∏•‡πá‡∏Å", price: 5.0, margin: 25 },
                    { name: "‡∏Å‡∏£‡∏∞‡∏õ‡πã‡∏≠‡∏á‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°", price: 55.0, margin: 25 },
                    { name: "‡∏ù‡∏≤‡πÄ‡∏´‡∏•‡πâ‡∏≤", price: 1.0, margin: 25 },
                    { name: "‡∏ù‡∏≤‡πÄ‡∏ô‡∏µ‡∏¢‡∏°", price: 15.0, margin: 25 },
                    { name: "‡∏ó‡∏≠‡∏á‡πÅ‡∏î‡∏á", price: 290.0, margin: 12 },
                    { name: "‡∏ó‡∏≠‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á", price: 180.0, margin: 15 },
                    { name: "‡∏Å‡∏£‡∏∞‡∏ó‡∏∞", price: 30.0, margin: 15 },
                    { name: "‡∏ï‡∏∞‡∏Å‡∏±‡πà‡∏ß", price: 40.0, margin: 15 },
                    { name: "‡∏™‡πÅ‡∏ï‡∏ô‡πÄ‡∏•‡∏™", price: 40.0, margin: 15 },
                    { name: "‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏´‡∏°‡πâ‡∏≠‡∏ô‡πâ‡∏≥", price: 40.0, margin: 15 },
                    { name: "‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏´‡∏ô‡∏≤", price: 45.0, margin: 15 },
                    { name: "‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏ö‡∏≤‡∏á", price: 45.0, margin: 18 },
                    { name: "‡∏•‡πâ‡∏≠‡πÅ‡∏°‡πá‡∏Å‡∏ã‡πå", price: 50.0, margin: 15 }
                ],
                styleClass: "cat-metal",
                defaultMargin: 15
            },
            "‡πÅ‡∏Å‡πâ‡∏ß": {
                items: [
                    { name: "‡πÅ‡∏Å‡πâ‡∏ß‡∏Ç‡∏≤‡∏ß", price: 1.5, margin: 50 },
                    { name: "‡πÅ‡∏Å‡πâ‡∏ß‡πÅ‡∏î‡∏á", price: 1.0, margin: 50 },
                    { name: "‡πÅ‡∏Å‡πâ‡∏ß‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß", price: 1.5, margin: 50 },
                    { name: "‡πÄ‡∏ö‡∏µ‡∏¢‡∏£‡πå‡∏™‡∏¥‡∏á‡∏´‡πå", price: 10.0, margin: 35 },
                    { name: "‡πÄ‡∏ö‡∏µ‡∏¢‡∏£‡πå‡∏•‡∏µ‡πÇ‡∏≠", price: 10.0, margin: 35 },
                    { name: "‡πÄ‡∏ö‡∏µ‡∏¢‡∏£‡πå‡∏ä‡πâ‡∏≤‡∏á", price: 15.0, margin: 35 },
                    { name: "‡πÄ‡∏ö‡∏µ‡∏¢‡∏£‡πå Hieneken", price: 15.0, margin: 35 },
                    { name: "‡πÄ‡∏´‡∏•‡πâ‡∏≤‡πÉ‡∏´‡∏ç‡πà", price: 11.0, margin: 35 },
                    { name: "‡πÄ‡∏´‡∏•‡πâ‡∏≤‡πÄ‡∏•‡πá‡∏Å", price: 20.0, margin: 35 },
                    { name: "‡∏´‡∏á‡∏©‡πå‡∏Å‡∏•‡∏°", price: 15.0, margin: 35 }
                ],
                styleClass: "cat-glass",
                defaultMargin: 40
            },
            "‡∏≠‡∏∑‡πà‡∏ô‡πÜ": {
                items: [
                    { name: "TV", price: 20.0, margin: 50 },
                    { name: "‡∏à‡∏≠‡∏Ñ‡∏≠‡∏°", price: 20.0, margin: 50 },
                    { name: "‡∏Ç‡∏≠‡∏á‡∏ñ‡∏≠‡∏î", price: 12.0, margin: 50 },
                    { name: "‡∏ï‡∏π‡πâ‡πÄ‡∏¢‡πá‡∏ô", price: 200.0, margin: 50 },
                    { name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ã‡∏±‡∏Å‡∏ú‡πâ‡∏≤", price: 150.0, margin: 50 },
                    { name: "‡πÅ‡∏≠‡∏£‡πå", price: 12.0, margin: 30 },
                    { name: "‡πÅ‡∏ö‡∏ï‡πÄ‡∏•‡πá‡∏Å", price: 18.0, margin: 30 },
                    { name: "‡πÅ‡∏ö‡∏ï‡πÉ‡∏´‡∏ç‡πà", price: 20.0, margin: 30 },
                    { name: "‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏û‡∏∑‡∏ä‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß", price: 19.0, margin: 35 }
                ],
                styleClass: "cat-other",
                defaultMargin: 30
            }
        }
    };

    /**
     * ==========================================
     * ZONE 2: STORAGE MANAGER (‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
     * ==========================================
     */
    const Storage = {
        KEY_DATA: 'recycle_appData_v2',
        KEY_SETTINGS: 'recycle_settings_v2',

        save: function(appData, settings) {
            localStorage.setItem(this.KEY_DATA, JSON.stringify(appData));
            localStorage.setItem(this.KEY_SETTINGS, JSON.stringify(settings));
        },

        load: function() {
            const data = localStorage.getItem(this.KEY_DATA);
            const settings = localStorage.getItem(this.KEY_SETTINGS);
            return {
                appData: data ? JSON.parse(data) : null,
                settings: settings ? JSON.parse(settings) : null
            };
        },

        clear: function() {
            localStorage.removeItem(this.KEY_DATA);
            localStorage.removeItem(this.KEY_SETTINGS);
        }
    };

    /**
     * ==========================================
     * ZONE 3: LOGIC (‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì)
     * ==========================================
     */
    let appData = {};
    let isTransportMode = true;
    let transportCostPerKg = 0;

    const App = {
        init: function() {
            // Load Data from LocalStorage or Config
            const saved = Storage.load();
            
            if (saved.appData) {
                appData = saved.appData;
            } else {
                appData = JSON.parse(JSON.stringify(Config.categories));
            }

            if (saved.settings) {
                document.getElementById('costPerKm').value = saved.settings.costPerKm;
                document.getElementById('distance').value = saved.settings.distance;
                document.getElementById('totalWeight').value = saved.settings.totalWeight;
                document.getElementById('transportToggle').checked = saved.settings.isTransportMode;
                isTransportMode = saved.settings.isTransportMode;
            }

            UI.updateModeDisplay(isTransportMode);
            UI.renderAll();
            this.calculate();
        },

        saveAll: function() {
            const settings = {
                costPerKm: document.getElementById('costPerKm').value,
                distance: document.getElementById('distance').value,
                totalWeight: document.getElementById('totalWeight').value,
                isTransportMode: document.getElementById('transportToggle').checked
            };
            Storage.save(appData, settings);
        },

        toggleMode: function() {
            isTransportMode = document.getElementById('transportToggle').checked;
            UI.updateModeDisplay(isTransportMode);
            this.calculate();
            this.saveAll(); // Save state
        },

        handleSettingChange: function() {
            this.calculate();
            this.saveAll();
        },

        calculate: function() {
            // 1. Calculate Transport Cost
            if (isTransportMode) {
                const cost = parseFloat(document.getElementById('costPerKm').value) || 0;
                const dist = parseFloat(document.getElementById('distance').value) || 0;
                let weight = parseFloat(document.getElementById('totalWeight').value) || 1;
                if (weight <= 0) weight = 1;
                transportCostPerKg = (cost * dist) / weight;
            } else {
                transportCostPerKg = 0;
            }
            
            document.getElementById('transportCostDisplay').innerText = transportCostPerKg.toFixed(2);

            // 2. Calculate Price for Every Item
            for (const catKey in appData) {
                appData[catKey].items.forEach((item, index) => {
                    const profit = item.price * (item.margin / 100);
                    let finalPrice = item.price - profit - transportCostPerKg;
                    if (finalPrice < 0) finalPrice = 0;
                    
                    const el = document.getElementById(`price-${catKey}-${index}`);
                    if (el) el.innerText = finalPrice.toFixed(2);
                });
            }
        },

        updateItemData: function(catKey, index, field, value) {
            if (field === 'price' || field === 'margin') {
                appData[catKey].items[index][field] = parseFloat(value) || 0;
                this.calculate(); 
            } else {
                appData[catKey].items[index][field] = value;
            }
            this.saveAll(); // Auto Save
        },

        addItem: function(catKey) {
            const defaultMargin = Config.categories[catKey].defaultMargin || 20;
            appData[catKey].items.push({ name: "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà", price: 0, margin: defaultMargin });
            UI.renderAll();
            this.calculate();
            this.saveAll(); // Auto Save
        },

        moveItem: function(catKey, index, direction) {
            const items = appData[catKey].items;
            const newIndex = index + direction;
            if (newIndex < 0 || newIndex >= items.length) return;
            [items[index], items[newIndex]] = [items[newIndex], items[index]];
            UI.renderAll();
            this.calculate();
            this.saveAll(); // Auto Save
        },

        deleteItem: function(catKey, index) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?')) {
                appData[catKey].items.splice(index, 1);
                UI.renderAll();
                this.calculate();
                this.saveAll(); // Auto Save
            }
        },

        resetToFactory: function() {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô?')) {
                Storage.clear();
                location.reload();
            }
        }
    };

    /**
     * ==========================================
     * ZONE 4: UI (‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•)
     * ==========================================
     */
    const UI = {
        renderAll: function() {
            const container = document.getElementById('app-container');
            container.innerHTML = '';

            for (const [catKey, catData] of Object.entries(appData)) {
                const group = document.createElement('div');
                group.className = `category-group ${catData.styleClass}`;

                const header = document.createElement('div');
                header.className = 'category-header';
                header.innerHTML = `<span>${catKey}</span> <span>‚ñº</span>`;
                header.onclick = () => {
                    const content = group.querySelector('.category-content');
                    content.classList.toggle('hidden');
                };

                const content = document.createElement('div');
                content.className = 'category-content hidden'; // Default hidden

                catData.items.forEach((item, index) => {
                    content.appendChild(this.createCard(catKey, index, item));
                });

                const btnAdd = document.createElement('button');
                btnAdd.className = 'btn-add';
                btnAdd.innerText = `+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î${catKey}`;
                btnAdd.onclick = () => App.addItem(catKey);
                content.appendChild(btnAdd);

                group.appendChild(header);
                group.appendChild(content);
                container.appendChild(group);
            }
        },

        createCard: function(catKey, index, item) {
            const card = document.createElement('div');
            card.className = 'card';
            
            card.innerHTML = `
                <input type="text" value="${item.name}" 
                       style="width:100%; border:none; font-weight:bold; border-bottom:1px dotted #ccc; margin-bottom:5px;"
                       onchange="App.updateItemData('${catKey}', ${index}, 'name', this.value)"
                       onfocus="this.select()">
                <div class="card-row">
                    <div class="input-group">
                        <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏•‡∏≤‡∏î</label>
                        <input type="number" step="0.1" value="${item.price}" 
                               oninput="App.updateItemData('${catKey}', ${index}, 'price', this.value)"
                               onfocus="this.select()">
                    </div>
                    <div class="input-group">
                        <label>% ‡∏Å‡∏≥‡πÑ‡∏£</label>
                        <input type="number" value="${item.margin}" 
                               oninput="App.updateItemData('${catKey}', ${index}, 'margin', this.value)"
                               onfocus="this.select()">
                    </div>
                    <div class="result-box">
                        <div class="result-price" id="price-${catKey}-${index}">0.00</div>
                        <div class="result-label">‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.</div>
                    </div>
                    
                    <div class="btn-move-group">
                        <button class="btn-move" onclick="App.moveItem('${catKey}', ${index}, -1)">‚ñ≤</button>
                        <button class="btn-move" onclick="App.moveItem('${catKey}', ${index}, 1)">‚ñº</button>
                    </div>

                    <button class="btn-del" onclick="App.deleteItem('${catKey}', ${index})">√ó</button>
                </div>
            `;
            return card;
        },

        updateModeDisplay: function(isTransport) {
            const panel = document.getElementById('transportSettings');
            const label = document.getElementById('modeLabel');
            if (isTransport) {
                panel.classList.add('active');
                label.innerText = "üöö ‡πÑ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á (‡∏Ñ‡∏¥‡∏î‡∏Ñ‡πà‡∏≤‡∏£‡∏ñ)";
                label.style.color = "#0369a1";
            } else {
                panel.classList.remove('active');
                label.innerText = "üë§ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏°‡∏≤‡∏™‡πà‡∏á‡πÄ‡∏≠‡∏á (‡πÑ‡∏°‡πà‡∏Ñ‡∏¥‡∏î‡∏Ñ‡πà‡∏≤‡∏£‡∏ñ)";
                label.style.color = "#166534";
            }
        },

        toggleModal: function(show) {
            const modal = document.getElementById('settingsModal');
            const gear = document.getElementById('gearIcon');
            if (show) {
                modal.style.display = 'block';
                gear.classList.add('spinning');
            } else {
                modal.style.display = 'none';
                gear.classList.remove('spinning');
            }
        }
    };

    window.onclick = function(event) {
        if (event.target == document.getElementById('settingsModal')) {
            UI.toggleModal(false);
        }
    }

    // Start App
    App.init();

</script>
</body>
</html>